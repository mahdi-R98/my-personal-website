<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>فرم تماس با رمز عبور دو مرحله‌ای</title>
  <style>
    @import url('https://cdn.fontcdn.ir/Font/Persian/Vazir/Vazir.css');
    :root {
      --color-primary: #222;
      --color-secondary: #555;
      --btn-bg: #0077ff;
      --btn-hover-bg: #005bbb;
      --error-text: #a00;
      --error-bg: #fdd;
      --bg-light: #f8f9fa;
      --modal-bg: rgba(0,0,0,0.6);
      --text-light: #eaeaea;
    }
    body {
      font-family: 'Vazir', Tahoma, sans-serif;
      background: var(--bg-light);
      color: var(--color-primary);
      margin: 0;
      padding: 0 10px 40px;
      min-height: 100vh;
      transition: background-color 0.3s ease, color 0.3s ease;
    }
    body.dark {
      background: #121822;
      color: var(--text-light);
    }
    header {
      text-align: center;
      margin: 30px auto 40px;
    }
    header h1 {
      font-size: 3rem;
      margin: 0;
      font-weight: 900;
    }
    header p {
      font-size: 1.2rem;
      color: var(--color-secondary);
      margin-top: 6px;
    }

    main {
      max-width: 780px;
      margin: 0 auto;
    }
    form {
      background: white;
      border-radius: 14px;
      box-shadow: 0 6px 18px rgb(0 0 0 / 0.15);
      padding: 22px 24px 30px;
      transition: background-color 0.3s ease;
    }
    body.dark form {
      background: #2c374c;
    }
    form label {
      display: block;
      margin-top: 18px;
      font-weight: 700;
      font-size: 1.1rem;
      color: var(--color-primary);
    }
    body.dark form label {
      color: var(--text-light);
    }
    form input[type="text"],
    form input[type="email"],
    form textarea {
      width: 100%;
      padding: 14px 18px;
      font-size: 1rem;
      border-radius: 12px;
      border: 2px solid var(--color-secondary);
      margin-top: 6px;
      font-family: 'Vazir', Tahoma, sans-serif;
      color: var(--color-primary);
      resize: vertical;
      transition: background-color 0.3s ease, border-color 0.3s ease;
    }
    body.dark form input[type="text"],
    body.dark form input[type="email"],
    body.dark form textarea {
      background: #34415a;
      border-color: #5578aa;
      color: var(--text-light);
    }
    form input[type="text"]:focus,
    form input[type="email"]:focus,
    form textarea:focus {
      outline: none;
      border-color: var(--btn-bg);
      background-color: #eaf4ff;
    }
    body.dark form input[type="text"]:focus,
    body.dark form input[type="email"]:focus,
    body.dark form textarea:focus {
      background-color: #3f4c78;
      border-color: #83aaff;
    }
    form button[type="submit"] {
      margin-top: 26px;
      background: var(--btn-bg);
      border: none;
      color: white;
      font-weight: 900;
      font-size: 1.25rem;
      padding: 14px 30px;
      border-radius: 28px;
      cursor: pointer;
      width: 100%;
      box-shadow: 0 6px 16px rgb(0 119 255 / 0.7);
      transition: background-color 0.3s ease, box-shadow 0.3s ease;
    }
    form button[type="submit"]:hover,
    form button[type="submit"]:focus-visible {
      background: var(--btn-hover-bg);
      outline: none;
      box-shadow: 0 8px 24px rgb(0 91 187 / 0.9);
    }

    #formStatus {
      margin-top: 14px;
      font-weight: 700;
      font-size: 1rem;
      min-height: 24px;
    }
    .status-error {
      color: var(--error-text);
    }
    .status-success {
      color: #006600;
    }

    #messagesList {
      margin-top: 40px;
      background: white;
      border-radius: 14px;
      box-shadow: 0 6px 18px rgb(0 0 0 / 0.15);
      padding: 20px 22px;
      max-height: 300px;
      overflow-y: auto;
      user-select: text;
      transition: background-color 0.3s ease, color 0.3s ease;
    }
    body.dark #messagesList {
      background: #2c374c;
      color: var(--text-light);
    }
    #messagesList h3 {
      margin-top: 0;
      font-weight: 900;
      font-size: 1.4rem;
      color: var(--color-primary);
    }
    body.dark #messagesList h3 {
      color: #a6c8ff;
    }
    .message {
      padding: 12px 14px;
      margin-bottom: 12px;
      border-radius: 14px;
      background: #f0f4ff;
      box-shadow: 0 2px 8px rgb(0 71 255 / 0.15);
      cursor: default;
      transition: background-color 0.3s ease;
    }
    body.dark .message {
      background: #3d4b72;
      box-shadow: 0 2px 8px rgb(101 129 255 / 0.3);
    }
    .message:hover,
    .message:focus-visible {
      background: #d0e1ff;
      outline: none;
    }
    body.dark .message:hover,
    body.dark .message:focus-visible {
      background: #576caf;
    }
    .msg-header {
      font-weight: 900;
      font-size: 0.9rem;
      color: var(--color-secondary);
    }
    body.dark .msg-header {
      color: #a6c8ff;
    }
    .msg-content {
      margin-top: 6px;
      white-space: pre-wrap;
      color: var(--color-primary);
    }
    body.dark .msg-content {
      color: var(--text-light);
    }

    /* مودال رمز عبور */
    #passwordModal {
      position: fixed;
      inset: 0;
      background: var(--modal-bg);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      user-select: none;
    }
    #passwordModalContent {
      background: var(--bg-light);
      border-radius: 18px;
      padding: 28px 36px;
      box-shadow: 0 5px 25px rgb(0 0 0 / 0.4);
      max-width: 320px;
      width: 90%;
      color: var(--color-primary);
      user-select: text;
      text-align: center;
    }
    body.dark #passwordModalContent {
      background: #2c374c;
      color: var(--text-light);
    }
    #passwordModalContent h2 {
      margin: 0 0 20px;
      font-weight: 800;
      font-size: 1.4rem;
      user-select: none;
    }
    #passwordModalContent input {
      width: 100%;
      padding: 14px 16px;
      font-size: 1.1rem;
      border-radius: 14px;
      border: 2px solid var(--color-secondary);
      margin-bottom: 18px;
      font-family: 'Vazir', Tahoma, sans-serif;
      color: var(--color-primary);
      transition: background 0.3s ease, border-color 0.3s ease;
      text-align: center;
    }
    body.dark #passwordModalContent input {
      background: #2f3a49;
      color: var(--text-light);
      border-color: #5578aa;
    }
    #passwordModalContent button {
      background: var(--btn-bg);
      border: none;
      color: white;
      font-weight: 700;
      font-size: 1.1rem;
      padding: 12px 0;
      border-radius: 24px;
      cursor: pointer;
      width: 100%;
      box-shadow: 0 5px 18px rgb(0 119 255 / 0.7);
      transition: background-color 0.3s ease;
    }
    #passwordModalContent button:hover,
    #passwordModalContent button:focus-visible {
      background: var(--btn-hover-bg);
      outline: none;
    }
    #passwordError {
      color: var(--error-text);
      font-weight: 600;
      margin-bottom: 12px;
      min-height: 22px;
    }

    /* دکمه تم تیره و روشن */
    #toggleThemeBtn {
      position: fixed;
      bottom: 30px;
      left: 30px;
      background: var(--btn-bg);
      border-radius: 50%;
      width: 56px;
      height: 56px;
      border: none;
      cursor: pointer;
      box-shadow: 0 6px 20px rgb(0 119 255 / 0.8);
      transition: background-color 0.3s ease;
      display: flex;
      justify-content: center;
      align-items: center;
      color: white;
      font-size: 24px;
      user-select: none;
      z-index: 10000;
    }
    #toggleThemeBtn:hover {
      background: var(--btn-hover-bg);
    }
    #toggleThemeBtn svg {
      width: 24px;
      height: 24px;
      transition: transform 0.35s ease;
    }
    #toggleThemeBtn.dark svg {
      transform: rotate(180deg);
    }
    /* انیمیشن تغییر آیکون */
    #toggleThemeBtn svg path {
      transition: fill 0.35s ease;
      fill: white;
    }

  </style>
</head>
<body>
  <header>
    <h1>فرم تماس با رمز عبور دو مرحله‌ای</h1>
    <p>ابتدا رمز عبور را وارد کنید تا بتوانید پیام‌ها را ارسال و مشاهده کنید.</p>
  </header>
  <main>
    <form id="contactForm" autocomplete="off" novalidate>
      <label for="name">نام و نام خانوادگی:</label>
      <input type="text" id="name" name="name" placeholder="نام شما" required />
      
      <label for="email">ایمیل:</label>
      <input type="email" id="email" name="email" placeholder="example@example.com" required />
      
      <label for="message">پیام شما:</label>
      <textarea id="message" name="message" placeholder="پیام خود را اینجا بنویسید" rows="5" required></textarea>
      
      <button type="submit">ارسال پیام</button>
      <div id="formStatus" aria-live="polite"></div>
    </form>

    <section id="messagesList" tabindex="0" aria-label="پیام‌های ارسالی">
      <h3>پیام‌ها</h3>
      <div id="messagesContainer" tabindex="0"></div>
    </section>
  </main>

  <!-- مودال رمز عبور -->
  <div id="passwordModal" role="dialog" aria-modal="true" aria-labelledby="passwordModalTitle" aria-describedby="passwordModalDesc" hidden>
    <div id="passwordModalContent">
      <h2 id="passwordModalTitle">ورود رمز عبور</h2>
      <p id="passwordModalDesc">برای ادامه لطفاً رمز عبور را وارد کنید.</p>
      <input type="password" id="passwordInput" aria-label="رمز عبور" autocomplete="current-password" />
      <div id="passwordError" role="alert" aria-live="assertive"></div>
      <button id="passwordSubmitBtn">تایید</button>
    </div>
  </div>

  <!-- دکمه تم تیره / روشن -->
  <button id="toggleThemeBtn" aria-label="تغییر تم تیره و روشن" title="تغییر تم">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="12" cy="12" r="5" />
      <line x1="12" y1="1" x2="12" y2="3" />
      <line x1="12" y1="21" x2="12" y2="23" />
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64" />
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78" />
      <line x1="1" y1="12" x2="3" y2="12" />
      <line x1="21" y1="12" x2="23" y2="12" />
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36" />
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22" />
    </svg>
  </button>

  <script>
    const correctPassword = '12345'; // رمز عبور اصلی (می‌تونی تغییرش بدی)
    let globalAccessGranted = false; // دسترسی کلی برای ارسال فرم
    let messageAccessGranted = false; // دسترسی برای دیدن پیام‌ها

    const passwordModal = document.getElementById('passwordModal');
    const passwordInput = document.getElementById('passwordInput');
    const passwordSubmitBtn = document.getElementById('passwordSubmitBtn');
    const passwordError = document.getElementById('passwordError');
    const contactForm = document.getElementById('contactForm');
    const formStatus = document.getElementById('formStatus');
    const messagesList = document.getElementById('messagesList');
    const messagesContainer = document.getElementById('messagesContainer');
    const toggleThemeBtn = document.getElementById('toggleThemeBtn');

    // نمایش مودال با پیغام خطا (اختیاری پیام)
    function openPasswordModal(message = '') {
      passwordError.textContent = message;
      passwordInput.value = '';
      passwordModal.hidden = false;
      passwordInput.focus();
    }
    function closePasswordModal() {
      passwordModal.hidden = true;
      passwordError.textContent = '';
      passwordInput.value = '';
    }

    // چک کردن رمز عبور در مودال و تعیین دسترسی
    function verifyPassword(forMessages = false) {
      const entered = passwordInput.value.trim();
      if (entered === correctPassword) {
        if (!globalAccessGranted) {
          globalAccessGranted = true;
          closePasswordModal();
          enableForm();
          formStatus.textContent = '';
        } else if (forMessages) {
          messageAccessGranted = true;
          closePasswordModal();
          showMessages();
        }
      } else {
        passwordError.textContent = 'رمز عبور اشتباه است.';
      }
    }

    // فعال/غیرفعال کردن فرم ارسال پیام
    function enableForm() {
      contactForm.querySelectorAll('input, textarea, button').forEach(el => {
        el.disabled = false;
      });
    }
    function disableForm() {
      contactForm.querySelectorAll('input, textarea, button').forEach(el => {
        el.disabled = true;
      });
    }

    // نمایش پیام‌ها فقط اگر دسترسی داشته باشیم
    function showMessages() {
      if (!messageAccessGranted) {
        openPasswordModal('برای مشاهده پیام‌ها لطفاً رمز عبور را وارد کنید.');
        return;
      }
      messagesContainer.innerHTML = '';
      if (messages.length === 0) {
        messagesContainer.innerHTML = '<p>هنوز هیچ پیامی ارسال نشده است.</p>';
        return;
      }
      messages.forEach(({name, email, message, time}, i) => {
        const div = document.createElement('div');
        div.className = 'message';
        div.tabIndex = 0;
        div.setAttribute('role', 'article');
        div.setAttribute('aria-label', `پیام شماره ${i + 1} از ${name}`);
        div.innerHTML = `
          <div class="msg-header">${name} - <a href="mailto:${email}" aria-label="ایمیل ${name}">${email}</a> - <time datetime="${time.toISOString()}">${time.toLocaleString()}</time></div>
          <div class="msg-content">${escapeHTML(message)}</div>
        `;
        messagesContainer.appendChild(div);
      });
    }

    // تابع برای ایمن‌سازی متن در HTML
    function escapeHTML(text) {
      return text.replace(/[&<>"']/g, (m) => ({
        '&':'&amp;',
        '<':'&lt;',
        '>':'&gt;',
        '"':'&quot;',
        "'":'&#39;'
      })[m]);
    }

    // لیست پیام‌ها در حافظه (Local) -- ساده ذخیره در localStorage
    let messages = JSON.parse(localStorage.getItem('messages') || '[]').map(m => {
      m.time = new Date(m.time);
      return m;
    });

    // ذخیره پیام‌ها در localStorage
    function saveMessages() {
      localStorage.setItem('messages', JSON.stringify(messages));
    }

    // بارگذاری تم از localStorage
    function loadTheme() {
      const theme = localStorage.getItem('theme');
      if (theme === 'dark') {
        document.body.classList.add('dark');
        toggleThemeBtn.classList.add('dark');
      }
    }
    loadTheme();

    // تغییر تم تیره و روشن
    toggleThemeBtn.addEventListener('click', () => {
      document.body.classList.toggle('dark');
      toggleThemeBtn.classList.toggle('dark');
      localStorage.setItem('theme', document.body.classList.contains('dark') ? 'dark' : 'light');
    });

    // هنگام باز شدن صفحه، مودال رمز عبور را باز می‌کنیم و فرم غیرفعال است
    disableForm();
    openPasswordModal();

    // تایید رمز عبور با کلیک دکمه یا اینتر
    passwordSubmitBtn.addEventListener('click', () => {
      verifyPassword(false);
    });
    passwordInput.addEventListener('keydown', e => {
      if (e.key === 'Enter') {
        e.preventDefault();
        verifyPassword(false);
      }
    });

    // وقتی روی لیست پیام‌ها کلیک شود، اگر دسترسی نداشته باشیم مودال باز می‌شود
    messagesList.addEventListener('click', () => {
      if (!messageAccessGranted) openPasswordModal('برای مشاهده پیام‌ها لطفاً رمز عبور را وارد کنید.');
      else showMessages();
    });

    // مدیریت ارسال فرم پیام
    contactForm.addEventListener('submit', e => {
      e.preventDefault();
      if (!globalAccessGranted) {
        formStatus.textContent = 'لطفاً ابتدا رمز عبور را وارد کنید.';
        formStatus.className = 'status-error';
        openPasswordModal();
        return;
      }
      formStatus.textContent = '';
      const name = contactForm.name.value.trim();
      const email = contactForm.email.value.trim();
      const message = contactForm.message.value.trim();
      if (name === '' || email === '' || message === '') {
        formStatus.textContent = 'لطفاً همه فیلدها را پر کنید.';
        formStatus.className = 'status-error';
        return;
      }
      // ساده بودن اعتبارسنجی ایمیل
      if (!/\S+@\S+\.\S+/.test(email)) {
        formStatus.textContent = 'ایمیل وارد شده معتبر نیست.';
        formStatus.className = 'status-error';
        return;
      }
      // ذخیره پیام
      messages.push({name, email, message, time: new Date()});
      saveMessages();
      formStatus.textContent = 'پیام با موفقیت ارسال شد.';
      formStatus.className = 'status-success';
      contactForm.reset();
      messageAccessGranted = false; // برای اینکه دوباره باید رمز برای دیدن پیام‌ها بزنی
      messagesContainer.innerHTML = '';
    });
  </script>
</body>
</html>
